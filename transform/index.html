<!doctype html>
<html>
<head>
    <meta charset=utf-8>
    <meta name=viewport content="width=device-width,maximum-scale=1,initial-scale=1,user-scalable=0">

    <title>ARIADOM: Yandex style</title>

    <script src=../design/role.js></script>
    <script src=../design/ARIAButton.js></script>
    <script src=../design/ARIACheckBox.js></script>
    <script src=../design/ARIARadioGroup.js></script>
    <script src=../design/ARIAListBox.js></script>
    <script src=../design/ARIAHTMLTextBox.js></script>
    <script>
        ARIAButton.attachToDocument();
        ARIACheckBox.attachToDocument();
        ARIARadioGroup.attachToDocument();
        ARIAListBox.attachToDocument();
        ARIAHTMLTextBox.attachToDocument();

        document.addEventListener('click', function() {}); // cure for iOS
    </script>
    <script src=domTransform.js></script>

    <link rel=stylesheet href=../style/yandex.css>
    <style>
        article
        {
            display: inline-block;
            padding: 0 20px;
            margin-right: 80px;
            vertical-align: top;
        }
        section
        {
            margin: 20px 0;
        }
    </style>
</head>
<body>
<script>
    var xhr = new XMLHttpRequest(),
        domTransform = new DOMTransform();

    xhr.addEventListener('load', onLoad);
    xhr.open('GET', 'index.xml');
    xhr.send();

    function onLoad(event) {
        var ts = Date.now(),
            root = this.responseXML.documentElement,
            don = domTransform.apply(root),
            result = domTransform.build(don);

        console.log(Date.now() - ts);
        document.body.appendChild(result);
        console.dir(don);
    }

    //================================================================================================

    /*domTransform.element('root', function(root) {
        return {
            element : 'div',
            children : this.apply(root.children)
        };
    });*/

    domTransform.element('root', { element : 'div' });

    /*domTransform.element('heading', function(heading) {
        var attrs = this.apply(heading.attributes);
        return {
            element : 'h' + (attrs.level || '1'),
            children : heading.textContent
        };
    });*/

    domTransform.element('heading', {
        element : function(name, heading) {
            return 'h' + (heading.getAttribute('level') || '1');
        },
        attributes : undefined
    });

    /*domTransform.element('heading', { element : 'h1' });*/

    /*domTransform.element('link', function(link) {
        var attrs = this.apply(link.attributes);
        return {
            element : 'a',
            attributes : {
                href : attrs.href,
                rel : attrs.rel,
                'class' : [attrs.view || 'link', attrs.mix].join(' ')
            },
            children : link.textContent
        };
    });*/

    domTransform.element('link', {
        element : 'a',
        attributes : function(attrs) {
            return {
                href : attrs.href,
                rel : attrs.rel,
                'class' : [attrs.view || 'link', attrs.mix].join(' ')
            };
        }
    });
</script>
    <template name=link data-copyattrs=true data-transform="attrs view mix children">
        <a href=attrs.href rel=attrs.rel class=link></a>
    </template>
<script>

    /*domTransform.element('button', function(button) {
        var attrs = this.apply(button.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'button',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-disabled' : attrs.disabled,
                'aria-pressed' : attrs.pressed,
                'class' : attrs.view || 'button'
            },
            children : button.textContent
        };
    });*/

    domTransform.element('button', {
        element : 'span',
        attributes : function(attrs) {
            return {
                role : 'button',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-disabled' : attrs.disabled,
                'aria-pressed' : attrs.pressed,
                'class' : attrs.view || 'button'
            }
        }
    });

    /*domTransform.element('checkbox', function(checkbox) {
        var attrs = this.apply(checkbox.attributes),
            view = attrs.view || 'checkbox',
            children = view === 'checkbox'? [
                {
                    element : 'span',
                    attributes : { 'class' : 'box' }
                },
                checkbox.textContent
            ] : checkbox.textContent;
        return {
            element : 'span',
            attributes : {
                role : 'checkbox',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-disabled' : attrs.disabled,
                'aria-checked' : attrs.checked,
                'class' : view
            },
            children : children
        };
    });*/

    domTransform.element('checkbox', {
        element : 'span',
        attributes : function(attrs) {
            var view = this.view = attrs.view || 'checkbox';
            return {
                role : 'checkbox',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-disabled' : attrs.disabled,
                'aria-checked' : attrs.checked,
                'class' : view
            }
        },
        children : function(children, checkbox) {
            return this.view === 'checkbox'? [
                {
                    element : 'span',
                    attributes : { 'class' : 'box' }
                },
                checkbox.textContent
            ] : this.apply(children)
        }
    });

    /*domTransform.element('radiogroup', function(radiogroup) {
        var attrs = this.apply(radiogroup.attributes);
        this.disabled = attrs.disabled === 'true';
        this.focusable = this.disabled? null :
            radiogroup.querySelector('radio[checked=true]') ||
                radiogroup.querySelector('radio');
        return {
            element : 'span',
            attributes : {
                role : 'radiogroup',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'radiogroup'
            },
            children : this.apply(radiogroup.children)
        };
    });*/

    domTransform.element('radiogroup', {
        element : 'span',
        attributes : function(attrs, radiogroup) {
            this.disabled = attrs.disabled === 'true';
            this.focusable = this.disabled? null :
                radiogroup.querySelector('radio[checked=true]') ||
                    radiogroup.querySelector('radio');
            return {
                role : 'radiogroup',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'radiogroup'
            };
        }
    });

    /*domTransform.element('radio',  function(radio) {
        var attrs = this.apply(radio.attributes),
            radiogroup = this.elements.radiogroup,
            view = attrs.view || 'radio',
            children = view === 'radio'? [
                {
                    element : 'span',
                    attributes : { 'class' : 'box' }
                },
                radio.textContent
            ] : radio.textContent;
        return {
            element : 'span',
            attributes : {
                role : 'radio',
                tabindex : radiogroup.disabled || attrs.disabled === 'true'?
                    undefined :
                    radio === radiogroup.focusable? '0' : '-1',
                'aria-checked' : attrs.checked,
                'aria-disabled' : attrs.disabled,
                'class' : view
            },
            children : children
        };
    });*/

    domTransform.element('radio', {
        element : 'span',
        attributes : function(attrs, radio) {
            var radiogroup = this.elements.radiogroup;
            this.view = attrs.view || 'radio';
            return {
                role : 'radio',
                tabindex : radiogroup.disabled || attrs.disabled === 'true'?
                    undefined :
                    radio === radiogroup.focusable? '0' : '-1',
                'aria-checked' : attrs.checked,
                'aria-disabled' : attrs.disabled,
                'class' : this.view
            };
        },
        children : function(children, radio) {
            return this.view === 'radio'? [
                {
                    element : 'span',
                    attributes : { 'class' : 'box' }
                },
                radio.textContent
            ] : this.apply(children);
        }
    });

    /*domTransform.element('listbox', function(listbox) {
        var attrs = this.apply(listbox.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'listbox',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'listbox'
            },
            children : [{
                element : 'span',
                attributes : { 'class' : 'box' },
                children : this.apply(listbox.children)
            }]
        };
    });*/
</script>
    <template name=listbox>
        <span role=listbox
              tabindex="attrs.disabled === 'true'? undefined : 0"
              aria-label=attrs.label>
            <span class=box>
                <template name=children></template>
            </span>
        </span>
    </template>
<script>
    domTransform.element('listbox', {
        element : 'span',
        attributes : function(attrs) {
            return {
                role : 'listbox',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'listbox'
            };
        },
        children : function(children) {
            return {
                element : 'span',
                attributes : { 'class' : 'box' },
                children : this.apply(children)
            }
        }
    });

    /*domTransform.element('option', function(option) {
        var attrs = this.apply(option.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'option',
                'aria-selected' : attrs.selected,
                'aria-checked' : attrs.checked,
                'class' : attrs.view || 'option'
            },
            children : option.textContent
        };
    });*/

    domTransform.element('option', {
        element : 'span',
        attributes : function(attrs) {
            return {
                role : 'option',
                'aria-selected' : attrs.selected,
                'aria-checked' : attrs.checked,
                'class' : attrs.view || 'option'
            };
        }
    });

    /*domTransform.element('textbox', function(textbox) {
        var attrs = this.apply(textbox.attributes),
            input = {
                element : 'input',
                attributes : {
                    autocomplete : 'off',
                    disabled : attrs.disabled,
                    value : attrs.value,
                    'class' : 'box'
                }
            };
        if(attrs.multiline === 'true') {
            input.element = 'textarea';
            delete input.attributes.value;
            input.children = attrs.value || '';
        }
        return {
            element : 'span',
            attributes : {
                role : 'textbox',
                'aria-label' : attrs.label,
                'class' : [
                    attrs.view || 'textbox',
                    attrs.disabled && 'disabled'
                ].join(' ').trim()
            },
            children : input
        };
    });*/

    domTransform.element('textbox', {
        element : 'span',
        attributes : function(attrs) {
            return {
                role : 'textbox',
                'aria-label' : attrs.label,
                'class' : [
                    attrs.view || 'textbox',
                    attrs.disabled && 'disabled'
                ].join(' ').trim()
            }
        },
        children : function(children, textbox) {
            var disabled = textbox.getAttribute('disabled') === 'true'? '' : undefined,
                value = textbox.getAttribute('value') || undefined;
            return textbox.getAttribute('multiline') === 'true'?
                {
                    element : 'textarea',
                    attributes : {
                        autocomplete : 'off',
                        disabled : disabled,
                        'class' : 'box'
                    },
                    children : value
                } :
                {
                    element : 'input',
                    attributes : {
                        autocomplete : 'off',
                        disabled : disabled,
                        value : value,
                        'class' : 'box'
                    }
                };
        }
    });

    /*domTransform
        .element('textbox')
        .attribute('multiline', 'true')
        .transform({
            children : function(children, textbox) {
                return {
                    element : 'textarea',
                    attributes : {
                        autocomplete : 'off',
                        disabled : this.attrs.disabled,
                        'class' : 'box'
                    },
                    children : this.attrs.value || ''
                };
            }
        });

    domTransform.element({
        name : 'textbox',
        attrName : 'multiline',
        attrValue : 'true'
    }, {
        children : function(children, textbox) {
            return {
                element : 'textarea',
                attributes : {
                    autocomplete : 'off',
                    disabled : this.attrs.disabled,
                    'class' : 'box'
                },
                children : this.attrs.value || ''
            };
        }
    });*/

    /*domTransform.element('group', function(group) {
        var attrs = this.apply(group.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'group',
                'aria-label' : attrs.label,
                'class' : attrs.view || 'group'
            },
            children : this.apply(group.children)
        };
    });*/

    domTransform.element('group', {
        element : 'span',
        attributes : function(attrs) {
            return {
                role : 'group',
                'aria-label' : attrs.label,
                'class' : attrs.view || 'group'
            };
        }
    });
</script>
</body>
</html>

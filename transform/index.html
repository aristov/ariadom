<!doctype html>
<html>
<head>
    <meta charset=utf-8>
    <meta name=viewport content="width=device-width,maximum-scale=1,initial-scale=1,user-scalable=0">

    <title>ARIADOM: Yandex style</title>

    <script src=../design/role.js></script>
    <script src=../design/ARIAButton.js></script>
    <script src=../design/ARIACheckBox.js></script>
    <script src=../design/ARIARadioGroup.js></script>
    <script src=../design/ARIAListBox.js></script>
    <script src=../design/ARIAHTMLTextBox.js></script>
    <script>
        ARIAButton.attachToDocument();
        ARIACheckBox.attachToDocument();
        ARIARadioGroup.attachToDocument();
        ARIAListBox.attachToDocument();
        ARIAHTMLTextBox.attachToDocument();

        document.addEventListener('click', function() {}); // cure for iOS
    </script>
    <script src=domTransform.js></script>

    <link rel=stylesheet href=../style/yandex.css>
    <style>
        article
        {
            display: inline-block;
            padding: 0 20px;
            margin-right: 80px;
            vertical-align: top;
        }
        section
        {
            margin: 20px 0;
        }
    </style>
</head>
<body>
<script>
    var xhr = new XMLHttpRequest(),
        domTransform = new DOMTransform();

    xhr.addEventListener('load', onLoad);
    xhr.open('GET', 'index.xml');
    xhr.send();

    function onLoad(event) {
        var ts = Date.now(),
            root = this.responseXML.documentElement,
            don = domTransform.apply(root),
            result = domTransform.transform(don);

        document.body.appendChild(result);
        console.log(Date.now() - ts);
        console.dir(don);
    }

    //================================================================================================

    domTransform.element('root', function(root) {
        return {
            element : 'div',
            children : this.apply(root.children)
        };
    });

    domTransform.element('heading', function(heading) {
        var attrs = this.apply(heading.attributes);
        return {
            element : 'h' + (attrs.level || '1'),
            children : heading.textContent
        };
    });

    domTransform.element('link', function(link) {
        var attrs = this.apply(link.attributes);
        return {
            element : 'a',
            attributes : {
                href : attrs.href,
                rel : attrs.rel,
                'class' : [attrs.view || 'link', attrs.mix].join(' ')
            },
            children : link.textContent
        };
    });

    domTransform.element('button', function(button) {
        var attrs = this.apply(button.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'button',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-disabled' : attrs.disabled,
                'aria-pressed' : attrs.pressed,
                'class' : attrs.view || 'button'
            },
            children : button.textContent
        };
    });

    domTransform.element('checkbox', function(checkbox) {
        var attrs = this.apply(checkbox.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'checkbox',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-disabled' : attrs.disabled,
                'aria-checked' : attrs.checked,
                'class' : attrs.view || 'checkbox'
            },
            children : [
                {
                    element : 'span',
                    attributes : { 'class' : 'box' }
                },
                checkbox.textContent
            ]
        };
    });

    domTransform.element('radiogroup', function(radiogroup) {
        var attrs = this.apply(radiogroup.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'radiogroup',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'radiogroup'
            },
            children : this.apply(radiogroup.children)
        };
    });

    domTransform.element('radio',  function(radio) {
        var attrs = this.apply(radio.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'radio',
                tabindex : attrs.disabled === 'true'? undefined : '-1',
                'aria-checked' : attrs.checked,
                'class' : attrs.view || 'radio'
            },
            children : [
                {
                    element : 'span',
                    attributes : { 'class' : 'box' }
                },
                radio.textContent
            ]
        };
    });

    domTransform.element('listbox', function(listbox) {
        var attrs = this.apply(listbox.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'listbox',
                tabindex : attrs.disabled === 'true'? undefined : '0',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'listbox'
            },
            children : [{
                element : 'span',
                attributes : { 'class' : 'box' },
                children : this.apply(listbox.children)
            }]
        };
    });

    domTransform.element('option', function(option) {
        var attrs = this.apply(option.attributes);
        return {
            element : 'span',
            attributes : {
                role : 'option',
                'aria-selected' : attrs.selected,
                'aria-checked' : attrs.checked,
                'class' : attrs.view || 'option'
            },
            children : option.textContent
        };
    });

    domTransform.element('textbox', function(textbox) {
        var attrs = this.apply(textbox.attributes),
            input = attrs.multiline === 'true'?
                {
                    element : 'textarea',
                    attributes : {
                        autocomplete : 'off',
                        disabled : attrs.disabled,
                        'class' : 'box'
                    },
                    children : attrs.value || ''
                } :
                {
                    element : 'input',
                    attributes : {
                        autocomplete : 'off',
                        disabled : attrs.disabled,
                        value : attrs.value,
                        'class' : 'box'
                    }
                };
        return {
            element : 'span',
            attributes : {
                role : 'textbox',
                'aria-label' : attrs.label,
                'aria-disabled' : attrs.disabled,
                'class' : attrs.view || 'textbox'
            },
            children : input
        };
    });

    domTransform.element('buttongroup', function(buttongroup) {
        var attrs = this.apply(buttongroup.attributes);
        return {
            element : 'span',
            attributes : {
                'aria-label' : attrs.label,
                'class' : attrs.view || 'buttongroup'
            },
            children : this.apply(buttongroup.children)
        };
    });
</script>
</body>
</html>

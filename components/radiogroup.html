<!doctype html>
<meta charset=utf-8>
<title>Радиогруппа</title>
<script src=ARIARadio.js></script>
<style>
    body
    {
        font: 13px Arial;
    }
</style>
<style>
    span[role=radiogroup]
    {
        display: inline-block;
    }
</style>
<style>
    span[role=radiogroup] button[role=radio]
    {
        margin: 0;
        border: 1px solid rgba(0, 0, 0, 0.2);
        background: #fff;
        cursor: pointer;
    }
    span[role=radiogroup] button[role=radio]:hover
    {
        border-color: rgba(0, 0, 0, 0.3);
    }
    span[role=radiogroup] button[role=radio]:focus
    {
        border-color: #ffdb4d;
        box-shadow: inset 0 0 0 1px #ffdb4d;
        outline: 0;
    }
    span[role=radiogroup] button[role=radio]:active
    {
        background: #f3f1ed;
    }
    span[role=radiogroup] button[role=radio]::-moz-focus-inner
    {
        border: 0;
    }
</style>
<style>
    span[role=radiogroup] button[role=radio][aria-checked=true]
    {
        background: #ffeba0;
    }
    span[role=radiogroup] button[role=radio][aria-checked=true]:not(:focus)
    {
        border-color: rgba(153, 122, 0, 0.5);
    }
    span[role=radiogroup] button[role=radio][aria-checked=true]:active
    {
        background: #fee481;
    }
</style>
<style>
    span[role=radiogroup] > label.leading
    {
        display: inline-block;
        margin-bottom: 6px;
        margin-right: 6px;
    }
</style>
<form>
    <label>Нативная радиогруппа</label><br>
    <label><input type=radio name=radioinput value=one>Раз</label>
    <label><input type=radio name=radioinput value=two checked disabled>Два</label>
    <label><input type=radio name=radioinput value=three>Три</label>
    <hr>
    <style>
        span[role=radiogroup].radiobar button[role=radio]
        {
            padding: 6px 10px;
            font: 13px/13px Arial;
        }
        span[role=radiogroup].radiobar button[role=radio]:not(:focus):not(:last-of-type)
        {
            border-right-width: 0;
        }
        span[role=radiogroup].radiobar button[role=radio]:focus + button[role=radio]
        {
            border-left-width: 0;
        }
        span[role=radiogroup].radiobar button[role=radio][aria-checked=true] + button[role=radio]:not(:focus)
        {
            border-left-color: rgba(153, 122, 0, 0.5);
        }
        span[role=radiogroup].radiobar button[role=radio]:first-of-type
        {
            border-top-left-radius: 3px;
            border-bottom-left-radius: 3px;
        }
        span[role=radiogroup].radiobar button[role=radio]:last-of-type
        {
            border-top-right-radius: 3px;
            border-bottom-right-radius: 3px;
        }
    </style>
    <span role=radiogroup class=radiobar> <!--div?-->
        <input type=hidden name=radiobar>
        <label class=leading>Радиобар</label><br>
        <button role=radio value=one>Раз</button
        ><button role=radio value=two>Два</button
        ><button role=radio value=three>Три</button>
    </span>
    <hr>
    <style>
        span[role=radiogroup].radiogroup label
        {
            display: inline-block;
        }
        span[role=radiogroup].radiogroup label > button[role=radio]
        {
            text-align: center;
            width: 14px;
            height: 14px;
            margin: 5px;
            padding: 0;
            border-radius: 7px;
            vertical-align: middle;
            position: relative;
            top: -2px;
        }
        span[role=radiogroup].radiogroup label > button[aria-checked=true]::before
        {
            content: '';
            display: inline-block;
            width: 6px;
            height: 6px;
            vertical-align: middle;
            border-radius: 3px;
            background: #000;
            position: relative;
            top: -2px;
        }
    </style>
    <span role=radiogroup class=radiogroup>
        <input type=hidden name=radiogroup value=one>
        <label class=leading>Радиогруппа</label><br>
        <label><button role=radio disabled value=one></button><span>Раз</span></label>
        <label><button role=radio value=two></button><span>Два</span></label>
        <label><button role=radio value=three></button><span>Три</span></label>
    </span>
    <hr>
    <span role=radiogroup class=radiogroup>
        <!--<input type=hidden name=vradiogroup value=two>-->
        <label class=leading>Вертикальная радиогруппа</label><br>
        <label><button role=radio value=one></button><span>Раз</span></label><br>
        <label><button role=radio aria-checked=true value=two></button><span>Два</span></label><br>
        <label><button role=radio value=three></button><span>Три</span></label>
    </span>
    <hr>
    <style>
        span[role=radiogroup] button[role=radio][disabled]
        {
            background: rgba(0, 0, 0, 0.08);
            border-color: transparent;
            cursor: default;
        }
        span[role=radiogroup] button[role=radio][aria-checked=true][disabled]
        {
            background: rgba(0, 0, 0, 0.15);
            border-color: transparent;
        }
        span[role=radiogroup].radiogroup label > button[role=radio][aria-checked=true][disabled]::before
        {
            opacity: 0.4;
        }
        span[role=radiogroup] button[role=radio][disabled] + span
        {
            opacity: 0.5;
        }
    </style>
    <span role=radiogroup class=radiogroup>
        <input type=hidden name=part-disabled value=trhee>
        <label class=leading>Частично заблокированная радиогруппа</label><br>
        <label>
            <button role=radio value=one disabled></button><span>Раз</span>
        </label>
        <label>
            <button role=radio value=two></button><span>Два</span>
        </label>
        <label>
            <button role=radio aria-checked=true disabled value=three></button><span>Три</span>
        </label>
        <label>
            <button role=radio value=four></button><span>Четыре</span>
        </label>
    </span>
    <hr>
    <style>
        span[role=radiogroup][aria-disabled=true] label.leading
        {
            opacity: 0.5;
        }
    </style>
    <span role=radiogroup class=radiogroup aria-disabled=true>
        <input type=hidden name=full-disabled value=trhee>
        <label class=leading>Полностью заблокированная радиогруппа</label><br>
        <label>
            <button role=radio value=one disabled></button><span>Раз</span>
        </label>
        <label>
            <button role=radio value=two disabled></button><span>Два</span>
        </label>
        <label>
            <button role=radio aria-checked=true disabled value=three></button><span>Три</span>
        </label>
        <label>
            <button role=radio value=four disabled></button><span>Четыре</span>
        </label>
    </span>
    <hr>
    <div id=transformed></div>
    <hr>
    <input type=submit>
</form>

<script type=ariaml id=radiogroup-source>
    <radiogroup view="radiobar" name="transformed" label="Шаблонизированная радиогруппа">
        <radio value="one" label="Раз"/>
        <radio value="two" label="Два" checked="true"/>
        <radio value="three" label="Три"/>
    </radiogroup>
</script>
<template>
    <span role=radiogroup class=radiobar>
        <input type=hidden name=transformed value=two>
        <label class=leading>Шаблонизированная радиогруппа</label><br>
        <button role=radio value=one>Раз</button>
        <button role=radio value=two aria-checked=true>Два</button>
        <button role=radio value=three>Три</button>
    </span>
</template>
<script type=tmp>
    function DOMTransform(node) {
        (this.constructor[node.nodeName] || this.element).call(this, node);
        return this.result;
    }

    DOMTransform['#text'] = function(node) {
        this.result = document.createTextNode(node.textContent);
    }

    DOMTransform.prototype.element = function(element) {
        this.result = document.createElement(element.tagName);

        if(element.hasAttributes())
            Array.prototype.forEach.call(element.attributes, function(attribute) {
                this.attr(attribute, element);
            }, this);

        if(element.hasChildNodes())
            Array.prototype.forEach.call(element.childNodes, function(node) {
                this.child(node);
            }, this);
    }

    DOMTransform.prototype.attr = function(attribute, element) {
        this.result.setAttribute(attribute.name, attribute.value);
    }

    DOMTransform.prototype.child = function(node) {
        this.result.appendChild(new DOMTransform(node));
    }
</script>
<script>
(function() {
    var ts = Date.now(),
        parser = new DOMParser(),
        source = document.getElementById('radiogroup-source').innerHTML.trim(),
        parsedDocument = parser.parseFromString(source, 'application/xml'),
        forEach = Array.prototype.forEach;

    function transform(node) {
        var nodeType = node.nodeType;

        if(nodeType === 1) {
            var result = document.createElement(node.nodeName);
            forEach.call(node.attributes, function(attribute) {
                result.setAttribute(attribute.name, attribute.value);
            });
            forEach.call(node.childNodes, function(child) {
                result.appendChild(transform(child));
            });
        } else if(nodeType === 3) {
            result = document.createTextNode(node.nodeValue);
        }
        return result;
    }

    console.log(transform(parsedDocument.documentElement));
    console.log(Date.now() - ts);
})();
</script>
<script type=tmp>
(function() {
    var parser = new DOMParser(),
        source = document.getElementById('radiogroup-source').innerHTML,
        parsedDocument = parser.parseFromString(source.trim(), 'application/xml');

    //document.getElementById('transformed').appendChild(element);

    function transform(element, data) {
        var tagName = element.tagName,
            result;

        if(tagName === 'radiogroup') {
            result = document.createElement('span');
            result.setAttribute('role', tagName);

            if(element.hasAttribute('view'))
                result.classList.add(element.getAttribute('view'));

            if(element.hasAttribute('name')) {
                var input = document.createElement('input'),
                    checkedRadio = element.querySelector('radio[checked=true]');
                input.type = 'hidden';
                input.name = element.getAttribute('name');
                if(checkedRadio) input.value = checkedRadio.getAttribute('value');
                result.appendChild(input);
            }

            if(element.hasAttribute('label')) {
                var label = document.createElement('label');
                label.classList.add('leading');
                label.textContent = element.getAttribute('label');
                result.appendChild(label);
                result.appendChild(document.createElement('br'));
            }
        }

        if(tagName === 'radio') {
            result = document.createElement('button');
            result.setAttribute('role', tagName);

            var label = element.getAttribute('label');
            if(label) result.textContent = label;

            var value = element.getAttribute('value');
            if(value) result.value = value;

            var checked = element.getAttribute('checked');
            if(checked) {
                result.setAttribute('aria-checked', checked);
                /*if(value) {
                    var inputElement = data.inputElement;
                    if(inputElement) inputElement.value = value;
                }*/
            }
        }

        var child = element.firstElementChild;
        if(child) do {
            result.appendChild(transform(child, { inputElement: input }));
        } while(child = child.nextElementSibling);

        /*Array.prototype.forEach.call(element.children, function(child) {
            result.appendChild(transform(child, { inputElement: inputElement }));
        });*/

        return result;
    }

    document
        .getElementById('transformed')
        .appendChild(transform(parsedDocument.documentElement));
})();
</script>
